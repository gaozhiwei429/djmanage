$(function(){function t(){var t=$("form").serialize();$.ajax({url:"/Item/getItemCount",type:"post",dataType:"json",data:t,success:function(t){$(".status_onsale").text(t.onsale),$(".status_be_on_shelves").text(t.be_on_shelves),$(".status_onsku").text(t.onsku),$(".status_outstock").text(t.outstock),$(".status_warn").text(t.warn),$(".status_gys_audit").text(t.gys_audit)}})}t(),$(document).on("keyup",".J-input-search",function(){var t=$(this),e=$(this).val(),n=t.siblings(".supplier_list");$(".supplier_search").find("input[name=supplier_id]").val(""),n.show(),$.ajax({url:"/Supplier/getSupplierByKeyword",type:"post",dataType:"json",data:{keyword:e},success:function(t){if(1==t.status&&0!=t.data.length){var e=_.template($("#tpl_supplier_lab").html(),{data:t.data}),a=$(e);n.empty().append(a).show()}else 1==t.status&&0==t.data.length?n.empty().show():n.empty().show()},error:function(){setTimeout(function(){$.ajax({url:"/Supplier/getSupplierByKeyword",type:"post",dataType:"json",data:{keyword:e},success:function(t){if(1==t.status&&0!=t.data.length){var e=_.template($("#tpl_supplier_lab").html(),{data:t.data}),a=$(e);n.empty().append(a).show()}}})},2e3)}})}),$(document).on("blur",".J-input-search",function(){$(".J-input-search").val()||($(".supplier_search").find("input[name=supplier_id]").val($(".supplier_list li.choice").val()),$(".supplier_search").find("input[name=supplier_name]").val($(".supplier_list li.choice").text()),$(this).parents(".supplier_search").find(".supplier_list").hide())}),$(document).on("click",".supplier_list li",function(){$(".supplier_search").find("input[name=supplier_id]").val($(".supplier_list li.choice").val()),$(".supplier_search").find("input[name=supplier_name]").val($(".supplier_list li.choice").text()),$(this).parents(".supplier_search").find(".supplier_list").hide()}),$(document).on("mousemove",".supplier_list li",function(){$(this).addClass("choice")}),$(document).on("mouseout",".supplier_list li",function(){$(this).removeClass("choice")}),$(".search").click(function(){t()}),$(".export").click(function(){$(".isout").val("1")}),$(".search").click(function(){$(".isout").val("0")}),$(".j-qrcode").click(function(){var t=$(this).data("id");HYD.showQrcode("/Public/rwcode/item_id/"+t)}),$(".j-del").click(function(){var t=$(this).data("id"),e=$(this).data("name"),n=[],a=[];return n.push(t),a.push(e),$.ajax({url:"/Item/delete_goods_stock?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{item_id:n,item_names:a},success:function(e){if(1==e.status){var n={content:"删除后将不可恢复，是否继续？",dataset:e.data};$html=_.template($("#tpl_jbox_simple_store").html(),n),height=300}else $html=_.template($("#tpl_jbox_simple").html(),{content:"删除后将不可恢复，是否继续？"}),height=200;$.jBox.show({title:"提示",content:$html,width:500,height:height,btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/delItem?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，删除成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，删除失败："+t.msg),$.jBox.hideloading()}})}}})}}),!1}),$(".btn_table_delAll").click(function(){var t=[],e=[],n=$(".table-ckbs:checked");return n.each(function(){t.push($(this).data("id")),e.push($(this).data("name"))}),t.length?($.ajax({url:"/Item/delete_goods_stock?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{item_id:t,item_names:e},success:function(e){if(console.log(e),1==e.status){var a={content:"删除后将不可恢复，是否继续？",dataset:e.data};$html=_.template($("#tpl_jbox_simple_store").html(),a),height=300}else $html=_.template($("#tpl_jbox_simple").html(),{content:"删除后将不可恢复，是否继续？"}),height=200;$.jBox.show({title:"提示",content:$html,width:500,height:height,btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/batch_action_del_item?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(n.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，删除成功！")}),setTimeout(function(){window.location.reload()},300)):HYD.hint("danger","对不起，删除失败："+t.msg),$.jBox.hideloading()}})}}})}}),!1):void HYD.hint("warning","对不起，请选择要删除的数据！")}),$(document).on("click",".store_list >span",function(){var t=$(this).data("value"),e=$(this).data("name");localStorage.setItem("store_shop_name",e),self.open(t)}),$(".j-offshelf").click(function(){var t=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认要下架此商品吗？"}),btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/offshelf?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".btn_table_offshelf").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"您确认要下架吗？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Item/batch_action_store_item?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要下架的数据！")}),$(".j-recommend").click(function(){var t=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认要将此商品置顶吗？"}),btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/ajaxItemRecommon?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,type:"recommon"},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-commend").click(function(){var t=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认要将此商品取消置顶吗？"}),btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/ajaxItemRecommon?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,type:"common"},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".btn_table_onshelf").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"您确认要上架吗？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Item/batch_action_display_item?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success",t.msg)}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要上架的数据！")}),$(".btn_table_groupAll").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"请选择商品分组",content:_.template($("#tpl_group_all").html()),btnOK:{onBtnClick:function(n){$.jBox.close(n);var a=[];n.find(".J-group_ids:checked").each(function(t){a.push($(this).val())}),$.ajax({url:"/Item/edit_group_all?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,group_ids:a},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要分组的商品！")}),$(".btn_delete_groupAll").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"批量取消分组",content:"确认取消已选择商品的分组？",btnOK:{onBtnClick:function(n){$.jBox.close(n);var a=[];n.find(".J-group_ids:checked").each(function(t){a.push($(this).val())}),$.ajax({url:"/Item/cancle_group_all?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要取消分组的商品！")}),$(".btn_table_setLevel").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"提示",content:_.template($("#tpl_level").html()),btnOK:{onBtnClick:function(n){$.jBox.close(n);var a=n.find("input[name='join_level_discount']:checked").val();$.ajax({url:"/Item/join_level_discount?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,join_level_discount:a},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success",t.msg)}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要批量开启或关闭会员等级折扣的商品！")}),$(".btn_table_pass").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"您确认要通过吗？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Item/batch_action?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,action:"supplier_pass"},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要通过的数据！")}),$(".btn_table_defuse").click(function(){var t=[],e=$(".table-ckbs:checked"),n="";return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"您确认要拒绝吗？",content:_.template($("#tpl_jbox_refuse").html()),btnOK:{onBtnClick:function(a){$.jBox.close(a),n=$(a).find("textarea").val(),$.ajax({url:"/Item/batch_action?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,action:"supplier_defuse",reason:n},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要拒绝的数据！")}),$(".j-comment").click(function(){var t=$(this).data("id");$.ajax({url:"/Item/getItemSku",type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?$.jBox.show({title:"添加评论",content:_.template($("#tpl_comment").html(),{comment_sku:e.data}),onOpen:function(t){var e=function(t,e){t.parent().parent().find("li").each(function(){var t=$(this).index();t<e||e==t?$(this).find("img").attr("src","/PublicMob/images/star_evaluate1.png"):$(this).find("img").attr("src","/PublicMob/images/star_evaluate.png")})};$(document).on("click",".j-add-imghead",function(){HYD.popbox.ImgPicker(function(t){var e="";e='<li class="j-add-imghead"><img src="'+t[0]+'">​</li>',$(".j-add-imghead").remove(),$(".img-list-head").prepend(e),$(".j_head_img").val(t[0])})}),t.find($(".j-describe ul>li")).click(function(){var t=$(this),n=t.index(),a=n+1;e(t,n),$("input[name='describe_star']").val(a)}),t.find($(".j-logistics ul>li")).click(function(){var t=$(this),n=t.index(),a=n+1;e(t,n),$("input[name='logistics_star']").val(a)}),t.find($(".j-service ul>li")).click(function(){var t=$(this),n=t.index(),a=n+1;e(t,n),$("input[name='service_star']").val(a)})},btnOK:{onBtnClick:function(e){$.jBox.close(e);var n=e.find("textarea[name='detail']").val(),a=e.find("input[name='user_name']").val(),i=e.find(".j-imglist-dataset").val(),o=e.find("input[name='create_time']").val(),s=e.find("input[name='describe_star']").val(),c=e.find("input[name='logistics_star']").val(),d=e.find("input[name='service_star']").val(),r=e.find(".j_head_img").val(),l=e.find("select[name='comment_sku']").val(),u=e.find("select[name='comment_sku'] option:checked").text();$.ajax({url:"/Item/ajax_comment?v="+Math.round(100*Math.random()),type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{type_id:t,detail:n,user_name:a,file_path:i,create_time:o,describe_star:s,logistics_star:c,service_star:d,head_img:r,sku_id:l,sku_name:u},success:function(t){1==t.status?(HYD.hint("success","恭喜，操作成功"+t.msg),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败"+t.msg),$.jBox.hideloading()}})}}}):HYD.hint("danger","读取SKU失败！请重试！"),$.jBox.hideloading()}})}),$(".j-repurchase").click(function(){var t=$(this),e=t.data("id"),n={price:t.data("price"),memberLevelPrice:t.data("memberlevelprice"),directOneLevelMoney:t.data("directonelevelmoney"),directTwoLevelMoney:t.data("directtwolevelmoney"),directThreeLevelMoney:t.data("directthreelevelmoney"),directOneMoney:t.data("directonemoney"),directOneRate:t.data("directonerate"),directTwoMoney:t.data("directtwomoney"),directTwoRate:t.data("directtworate"),directThreeMoney:t.data("directthreemoney"),directThreeRate:t.data("directthreerate"),fxCommission:t.data("fxcommission"),agencyOneMoney:t.data("agencyonemoney"),agencyOneRate:t.data("agencyonerate"),agencyTwoMoney:t.data("agencytwomoney"),agencyTwoRate:t.data("agencytworate"),agencyThreeMoney:t.data("agencythreemoney"),agencyThreeRate:t.data("agencythreerate"),dlCommission:t.data("dlcommission"),getLower:t.data("getlower"),is_repurchase:$(".is_repurchase").val(),store_money:t.data("storemoney"),store_rate:t.data("storerate"),is_store_commission:t.data("storecommission"),store_rank_award_money:t.data("storerankawardcommission"),staff_money:t.data("staffmoney"),staff_rate:t.data("staffrate"),is_staff_commission:t.data("staffcommission"),is_dl_set:t.data("dlset"),store_award:t.data("storeaward"),store_award_rate:t.data("storeawardrate"),is_award_commission:t.data("isawardcommission")},a=_.template($("#tpl_repurchase").html(),{defaults:n}),i=$(a),o=i.find("input[name='repurchase_price']"),s=i.find("input[name='directly_money']"),c=i.find("input[name='directly_rate']"),d=i.find("input[name='superior_money']"),r=i.find("input[name='superior_rate']"),l=i.find("input[name='three_money']"),u=i.find("input[name='three_rate']"),m=i.find("input[name='dls_directly_money']"),p=i.find("input[name='dls_directly_rate']"),h=i.find("input[name='dls_superior_money']"),f=i.find("input[name='dls_superior_rate']"),v=i.find("input[name='dls_three_money']"),g=i.find("input[name='dls_three_rate']"),j=i.find("input[name='store_award']"),x=i.find("input[name='store_award_rate']");$.jBox.show({title:"添加复购",width:"480",content:i,onOpen:function(a){if(a.find(".tips").tooltips(a),n.memberLevelPrice){var o=n.memberLevelPrice;if(o.price)for(var s=0;s<o.price.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.price[s].id+">"+o.price[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.price[s].pri+'">元</td></tr>';$("#memberLvPrice").append(c)}}if(t.data("directonelevelmoney")){var o=t.data("directonelevelmoney");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#directOneMoney").append(c)}}if(t.data("directtwolevelmoney")){var o=t.data("directtwolevelmoney");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#directTwoMoney").append(c)}}if(t.data("directthreelevelmoney")){var o=t.data("directthreelevelmoney");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#directThreeMoney").append(c)}}if(t.data("storerankcommission")){var o=t.data("storerankcommission");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#shopMoney").append(c)}}if(t.data("storegraderankcommission")){var o=t.data("storegraderankcommission");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#shopGradeMoney").append(c)}}if(t.data("storerankawardcommission")){var o=t.data("storerankawardcommission");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#storeAwardMoney").append(c)}}if(t.data("staffrankcommission")){var o=t.data("staffrankcommission");if(o.commission)for(var s=0;s<o.commission.length;s++){var c='<tr><td class="tables-form-title" data-id='+o.commission[s].id+">"+o.commission[s].level+'</td><td><input type="text" class="input mini" name="rank_price" value="'+o.commission[s].pri+'">元 或 <input type="text" class="input mini" name="directly_agent_rate[]" value="'+o.commission[s].rate+'">%</td></tr>';$("#staffMoney").append(c)}}$(".jbox-buttons").prepend("<a href='javascript:;' class='jbox-buttons-ok btn btn-danger j-del'>清除</a>"),$(".bhaide").on("click",function(){$(this).parent().children(".setfxs-box, .setfxs-level-box").slideDown(),$(this).parent().children(".J-close-setbox").attr("style","opacity:1"),$(this).parent().next(".fi-help-text2").css("margin-top","6px")}),$(".J-close-setbox").on("click",function(){$(this).parent().children(".setfxs-box, .setfxs-level-box").slideUp(),$(this).attr("style","opacity:0"),$(this).parent().next(".fi-help-text2").css("margin-top","-35px")}),$(".j-del").click(function(){$.ajax({url:"/Item/repurchase",type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{item_id:e,action:"del"},success:function(t){1==t.status?(HYD.hint("success","恭喜，操作成功"+t.msg),setTimeout(function(){window.location.reload(),i.find("input").val(""),i.find("input:checked").removeAttr("checked"),$("label:contains('关闭')").find("input").attr("checked","checked")},1e3)):HYD.hint("danger","对不起，操作失败"+t.msg),$.jBox.hideloading()}})})},btnOK:{onBtnClick:function(t){function n(t,e){this.dom=t,this.arrName=e;for(var n=[],a=0;a<this.dom.find(".tables-form-title").length;a++)n.push([]),n[a].push(new Array(2)),n[a][0]=this.dom.find(".tables-form-title").eq(a).data("id"),n[a][1]=parseFloat(this.dom.find("input[name='rank_price']").eq(a).val()),this.dom.find("input[name='directly_agent_rate[]']").eq(a).length>0&&(n[a][2]=parseFloat(this.dom.find("input[name='directly_agent_rate[]']").eq(a).val()));for(var i="",o=0;o<n.length;o++){var s='{"level":"'+n[o][0]+'","pri":"'+n[o][1]+'"';void 0!==n[o][2]&&(s+=',"rate":"'+n[o][2]+'"'),s+="},",i+=s}return i='{"'+this.arrName+'":['+i.substring(0,i.length-1)+"]}","string"==typeof i&&(i=JSON.parse(i)),i}var a=new n($("#memberLvPrice"),"price"),_=new n($("#directOneMoney"),"commission"),y=new n($("#directTwoMoney"),"commission"),b=new n($("#directThreeMoney"),"commission"),w=new n($("#shopMoney"),"commission"),k=new n($("#staffMoney"),"commission"),B=new n($("#storeAwardMoney"),"commission"),D=i.find('input[name="is_fx_commission"]:checked'),T=i.find("input[name='is_dl_commission']:checked"),M=i.find('input[name="is_dl_set"]:checked'),H=i.find("input[name='is_get_lower']:checked");$.jBox.close(t);var Y=o.val(),I=a,O=_,S=y,C=b,K=w,E=k,P=B,F=s.val(),L=parseFloat(c.val()),A=d.val(),q=parseFloat(r.val()),J=l.val(),N=parseFloat(u.val()),R=D.val(),U=m.val(),z=parseFloat(p.val()),Q=h.val(),G=parseFloat(f.val()),V=v.val(),X=parseFloat(g.val()),Z=T.val(),W=i.find("input[name='is_repurchase']:checked").val(),tt=i.find("input[name='store_money']").val(),et=i.find("input[name='store_rate']").val(),nt=i.find("input[name='is_store_commission']:checked").val(),at=i.find("input[name='staff_money']").val(),it=i.find("input[name='staff_rate']").val(),ot=i.find("input[name='is_staff_commission']:checked").val(),st=M.val(),ct=H.val(),dt=j.val(),rt=parseFloat(x.val()),lt=i.find("input[name='is_award_commission']:checked").val();console.log(C,K,E),$.ajax({url:"/Item/repurchase",type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{item_id:e,repurchase_price:Y,member_level_price:I,direct_one_level_money:O,direct_two_level_money:S,direct_three_level_money:C,store_rank_commission:K,staff_rank_commission:E,store_rank_award_commission:P,directly_money:F,directly_rate:L,superior_money:A,superior_rate:q,three_money:J,three_rate:N,is_fx_commission:R,dls_directly_money:U,dls_directly_rate:z,dls_superior_money:Q,dls_superior_rate:G,dls_three_money:V,dls_three_rate:X,is_dl_commission:Z,is_get_lower:ct,action:"add",is_repurchase:W,store_money:tt,store_rate:et,is_store_commission:nt,staff_money:at,staff_rate:it,is_staff_commission:ot,is_dl_set:st,store_award:dt,store_award_rate:rt,is_award_commission:lt},success:function(t){1==t.status?(HYD.hint("success","恭喜，操作成功"+t.msg),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败"+t.msg),$.jBox.hideloading()}})}}})});var e,n,a=function(t,a){var i=function(t,i){return function(){$("#share_video")&&$("#share_video").length>0?(n++,$.ajax({url:"/Item/get_ajax_key",data:{key:t},success:function(t){if(n>=100)return i.queueItem.find(".fileinfo").html(" - 上传失败"),i.queueItem.find(".progress").slideUp(250),i.queueItem.addClass("error"),i.queueItem.delay(1500).fadeOut("slow",function(){$(this).remove()}),clearInterval(e),console.log("上传失败，超过300s"),HYD.hint("danger","上传失败"),!1;if(1==t.status&&(i.queueItem.find(".progress-bar").css("width","100%"),i.queueItem.find(".fileinfo").html(" - 上传成功"),i.queueItem.find(".progress").slideUp(250),i.queueItem.addClass("complete"),i.queueItem.delay(1500).fadeOut("slow",function(){$(this).remove()}),clearInterval(e),HYD.hint("success","上传成功"),t.data)){var o=JSON.parse(t.data);console.log(o);var s=o.pic_url;a.find("input[name='share_url']").val(s)}}})):clearInterval(e)}};a.find("#imgpicker_upload_input").uploadifive({auto:!0,formData:{PHPSESSID:$.cookie("PHPSESSID"),type:"video"},width:120,height:120,multi:!1,uploadScript:"/Item/item_video_upload",buttonText:"+",buttonClass:"uploadProgressFalse",fileSizeLimit:"30MB",fileType:"video/mp4",onFallback:function(){HYD.hint("danger","请使用支持html5上传的浏览器")},onUploadComplete:function(t,a){clearInterval(e);var a=JSON.parse(a);if(1==a.status){var o=a.data;n=0,e=setInterval(i(o,t),3e3)}else HYD.hint("danger","对不起："+a.msg)},onError:function(t){t="FILE_SIZE_LIMIT_EXCEEDED"==t||"FORBIDDEN_FILE_TYPE"==t?"请上传30M以内mp4格式的视频":"上传失败，请重试",HYD.hint("danger","对不起："+t)}})};$(".j-video").click(function(){var t=$(this),n=t.data("id"),i={share_path:t.data("url"),share_code:t.data("code")},o=_.template($("#share_path").html(),{defaults:i}),s=$(o),c=s.find("input[name='share_url']");$.jBox.show({title:"视频录制",width:"500",height:"450",content:s,onOpen:function(t){a(t,s)},onClosed:function(t){clearInterval(e)},btnCancel:{onBtnClick:function(t){clearInterval(e),$.jBox.close(t)}},btnOK:{onBtnClick:function(t){clearInterval(e);var a=$.trim(c.val());$.ajax({url:"/Item/item_video_url",type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{item_id:n,url:a},success:function(e){1==e.status?($.jBox.close(t),HYD.hint("success","恭喜，操作成功。"+e.msg),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败。"+e.msg),$.jBox.hideloading()}})}}})}),$(document).on("click",".img-list-add",function(){HYD.popbox.ImgPicker(function(t){for(var e="",n=$(".j-imglist-dataset").val(),a=0;a<t.length;a++)e+='<li><img src="'+t[a]+'">​</li>',n+=t[a]+";";$(".img-list").prepend(e),$(".j-imglist-dataset").val(n)})}),$(".intem").click(function(){$(this).addClass("cur").siblings().removeClass("cur");var t=parseInt($(this).text());$.post("/Item/lists",{pagelist:t},function(t){window.location.href=""})}),$(".j-update").click(function(){var t=$(this).data("id");$.jBox.show({title:"同步淘宝",content:"确认同步吗？",btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/updata_taobao_item?v="+Math.round(100*Math.random()),type:"post",dataType:"json",beforeSend:function(){$.jBox.showloading()},data:{id:t},success:function(t){1==t.status?(HYD.hint("success","恭喜，操作成功"+t.msg),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败"+t.msg),$.jBox.hideloading()}})}}})}),$(".j_alibaba").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"提示",content:_.template($("#tpl_import_item").html()),btnOK:{onBtnClick:function(n){$.jBox.close(n);var a=n.find("select[name='shop_id']").val();$.ajax({url:"/Item/export_item_alibaba?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{ids:t,shop_id:a},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，导入成功"+t.data.success+"条，导入失败"+t.data.fail+"条")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要导入的商品！")}),$(".j_postfee").click(function(){var t=[],e=$(".table-ckbs:checked");if(e.each(function(){t.push($(this).data("id"))}),!t.length)return void HYD.hint("warning","对不起，请选择要设置运费的商品！");var n=$("#tpl_post_fee").html(),a=$(n);return a.change(".j-feight",function(){var t=$(".j-feight-ipt"),e=$("#freight_tpl_id"),n=a.find(".j-feight:checked").val();switch(n){case"1":t.attr("disabled",!0),e.attr("disabled",!0);break;case"2":t.attr("disabled",!1),e.attr("disabled",!0);break;case"3":t.attr("disabled",!0),e.attr("disabled",!1)}}),$.jBox.show({title:"批量设置运费",content:a,btnOK:{onBtnClick:function(n){var i=a.find('input[name="freight_payer"]:checked'),o=a.find('input[name="post_fee"]'),s=a.find('select[name="freight_tpl_id"]'),c=i.val(),d=parseFloat(o.val()),r=s.val();if(2==c){if(isNaN(d)||0==d)return void HYD.FormShowError(o,"请填写正确的邮费")}else if(3==c&&0==r)return void HYD.FormShowError(s,"请选择运费模版");$.jBox.close(n),$.ajax({url:"/Item/setPostFee?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,freight_payer:c,post_fee:d,freight_tpl_id:r},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-copyitem").click(function(){var t=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"复制后,将会发布一款相同的商品,确认复制吗？"}),btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/copyItem?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，复制成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，复制失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".batch_update_price").click(function(){var t=[],e=$(".table-ckbs:checked");if(e.each(function(){t.push($(this).data("id"))}),!t.length)return void HYD.hint("warning","对不起，请选择要修改价格的商品！");var n=$("#tpl_item_price").html(),a=$(n);return $.jBox.show({title:"批量修改价格",content:a,btnOK:{onBtnClick:function(n){var a=n.find('input[name="price"]').val(),i=n.find('select[name="type"]').val(),o=n.find('input[name="fixedPrice"]').val(),s=[];if(n.find('input[name="priceType"]:checked').each(function(){s.push($(this).val())}),4==i){if(a<=0||o<0)return HYD.hint("danger","请输入有效价格"),!1}else if(a<0||o<0)return HYD.hint("danger","请输入有效价格"),!1;$.jBox.close(n),$.ajax({url:"/Item/batchUpdatePrice?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{ids:t,price:a,type:i,fixedPrice:o,priceType:s},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，修改成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".batch_update_num").click(function(){var t=[],e=$(".table-ckbs:checked");if(e.each(function(){t.push($(this).data("id"))}),!t.length)return void HYD.hint("warning","对不起，请选择要修改库存的商品！");var n=$("#tpl_item_num").html(),a=$(n);return $.jBox.show({title:"批量修改库存",content:a,btnOK:{onBtnClick:function(n){var a=n.find('input[name="num"]').val(),i=n.find('select[name="type"]').val(),o=n.find('input[name="fixedNum"]').val();$.jBox.close(n),$.ajax({url:"/Item/batchUpdateNum?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{ids:t,num:a,type:i,fixedNum:o},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，修改成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".batch_update_class").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?void $.post("/Item/ajaxShopClass/",{},function(n){var a=_.template($("#tpl_item_class").html(),{data:n}),i=$(a);return $.jBox.show({title:"批量修改分类",content:i,btnOK:{onBtnClick:function(n){var a=[];n.find(" .j-chang-firstfloor>label>input").each(function(){var t=$(this).attr("checked"),e=$(this).val();t&&a.push(e)}),n.find(" .j-change>label>input").each(function(){var t=$(this).attr("checked"),e=$(this).val();t&&a.push(e)}),n.find(" .j-midchange>label>input").each(function(){var t=$(this).attr("checked"),e=$(this).val();t&&a.push(e)});var i=a.join(",");$.jBox.close(n),$.ajax({url:"/Item/batchUpdateClass?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{ids:t,class_id:i},beforeSend:function(){$.jBox.showloading()},success:function(t){
1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，修改成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，修改失败："+t.msg),$.jBox.hideloading()}})}}}),!1}):void HYD.hint("warning","对不起，请选择要修改分类的商品！")}),$(".j-arayacak").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?void $.jBox.show({title:"设置门店自提/配送",content:_.template($("#tpl_arayacak").html()),onOpen:function(e){e.find(".jbox-buttons").prepend('<a href="javascript:;" class="j-allselectuseless btn btn-primary">取消全部</a><a href="javascript:;" class="j-allselect btn btn-primary">全选</a>'),e.find(".j-allselect").click(function(){e.find(".jbox-container .J-group_ids").prop("checked",!0)}),e.find(".j-allselectuseless").click(function(){e.find(".jbox-container .J-group_ids").prop("checked",!1)}),e.css("width","600px"),e.find(".receiving_address").css({width:"370px","vertical-align":"top","margin-left":"15px"}),e.find(".receiving_store").css({width:"180px","vertical-align":"top"});var n='<option value="0">请选择省份</option>';$.ajax({url:"/System/getProvince?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{},success:function(t){1==t.status?($.each(t.data,function(e,a){n+="<option value='"+t.data[e].province_id+"'>"+t.data[e].province_name+"</option>"}),$(".c_province").empty().append(n)):$(".c_province").empty().append('<option value="0">请选择</option>')}}),$.ajax({url:"/Item/get_item_staff?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{item_id:t},success:function(t){var n=t.length;if(n>0)for(var a=0;a<n;a++)t[a].self_address_id&&e.find('input[value="'+t[a].self_address_id+'"]')&&e.find('input[value="'+t[a].self_address_id+'"]').attr("checked","checked")}})},btnOK:{onBtnClick:function(e){$.jBox.close(e);var n=[];e.find(".j_self_address .J-group_ids:checked").each(function(t){n.push($(this).val())}),$.ajax({url:"/Item/set_staff",type:"post",dataType:"json",data:{item_ids:t,store_ids:n},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，设置成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，设置失败：请检查门店选择！"),$.jBox.hideloading()}})}}}):void HYD.hint("warning","对不起，请选择要设置门店自提/配送的商品！")}),$(document).on("change",".c_province",function(){$("select[name='city_id']").val(""),$("select[name='area_id']").val("");var t='<option value="0">请选择</option>',e=$(".c_province").val();$.ajax({url:"/System/getCity?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{province_id:e},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?($.each(e.data,function(n,a){t+="<option value='"+e.data[n].city_id+"'>"+e.data[n].city_name+"</option>"}),$(".c_city").empty().append(t),i()):i(),$.jBox.hideloading()}})}),$(document).on("change",".c_city",function(){$("select[name='area_id']").val("");var t='<option value="0">请选择</option>',e=$(".c_city").val();$.ajax({url:"/System/getArea?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{city_id:e},beforeSend:function(){$.jBox.showloading()},success:function(e){1==e.status?($.each(e.data,function(n,a){t+="<option value='"+e.data[n].area_id+"'>"+e.data[n].area_name+"</option>"}),$(".c_area").empty().append(t),i()):i(),$.jBox.hideloading()}})}),$(document).on("change",".c_area",function(){i()});var i=function(){$.ajax({url:"/Item/ajaxSearchSelfAddress?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{province_id:$("select[name='province_id']").val(),city_id:$("select[name='city_id']").val(),area_id:$("select[name='area_id']").val()},beforeSend:function(){$.jBox.showloading()},success:function(t){if(1==t.status){var e=_.template($("#tpl_self_address").html(),{data:t.result_list}),n=$(e);$(".j_self_address, .j_self_address_hide").empty().append(n),$("input[name='store_name']").val("")}else HYD.hint("danger","对不起，操作失败："+t.msg);$.jBox.hideloading()},error:function(){$.jBox.hideloading()}})};$(document).on("keyup",".store_name",function(){var t,e,n,a=$(this),i=[],o=[],s=$(".j_self_address_hide .goods_group"),c=$(".j_self_address_hide .receiving_address"),d=$(".j_self_address_hide .receiving_store"),r=[],l=[],u="";c.each(function(){i.push($(this)[0].innerText)}),d.each(function(){o.push($(this)[0].innerText)});var m=i.length,p=o.length;for(t=0;t<m;t++)i[t].indexOf(a.val())!=-1&&r.push(t);for(t=0;t<p;t++)o[t].indexOf(a.val())!=-1&&l.push(t);if(l.length)for(n=0;n<l.length;n++)u+=s[l[n]].outerHTML;else for(e=0;e<r.length;e++)u+=s[r[e]].outerHTML;$(".j_self_address").empty().append(u)}),$(document).on("paste",".store_name",function(){var t=$(this);setTimeout(function(){var e,n,a,i=[],o=[],s=$(".j_self_address_hide .goods_group"),c=$(".j_self_address_hide .receiving_address"),d=$(".j_self_address_hide .receiving_store"),r=[],l=[],u="";c.each(function(){i.push($(this)[0].innerText)}),d.each(function(){o.push($(this)[0].innerText)});var m=i.length,p=o.length;for(e=0;e<m;e++)i[e].indexOf(t.val())!=-1&&r.push(e);for(e=0;e<p;e++)o[e].indexOf(t.val())!=-1&&l.push(e);if(l.length)for(a=0;a<l.length;a++)u+=s[l[a]].outerHTML;else for(n=0;n<r.length;n++)u+=s[r[n]].outerHTML;$(".j_self_address").empty().append(u)},0)}),$(".j-offshop").click(function(){var t=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认要分销商在店中店手动上架该商品吗？"}),btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/offshelf?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,type:2},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-recoveryshop").click(function(){var t=$(this).data("id");return $.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"确认要恢复店中店手动上架的商品吗？"}),btnOK:{onBtnClick:function(e){$.jBox.close(e),$.ajax({url:"/Item/offshelf?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,type:3},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".j-audit").click(function(){var t=$(this).data("id"),e=$(this).data("dz"),n="";if(0==e)var a="确定审核通过？",i="提示",o=_.template($("#tpl_jbox_simple").html(),{content:a});else var i="确定拒绝审核通过？",o=_.template($("#tpl_jbox_refuse").html(),{content:a});return $.jBox.show({title:i,content:o,btnOK:{onBtnClick:function(a){$.jBox.close(a),n=$(a).find("textarea").val(),$.ajax({url:"/Item/handle_audit?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,dz:e,reason:n},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(HYD.hint("success","恭喜您，操作成功！"),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1}),$(".btn_table_beOnShelves").click(function(){var t=[],e=$(".table-ckbs:checked");return e.each(function(){t.push($(this).data("id"))}),t.length?($.jBox.show({title:"提示",content:_.template($("#tpl_jbox_simple").html(),{content:"您确认要把商品移动到待上架列表吗？"}),btnOK:{onBtnClick:function(n){$.jBox.close(n),$.ajax({url:"/Item/batch_action?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:t,action:"be_on_shelves"},beforeSend:function(){$.jBox.showloading()},success:function(t){1==t.status?(e.parents("tr").fadeOut(300,function(){HYD.hint("success","恭喜您，操作成功！")}),setTimeout(function(){window.location.reload()},1e3)):HYD.hint("danger","对不起，操作失败："+t.msg),$.jBox.hideloading()}})}}}),!1):void HYD.hint("warning","对不起，请选择要待上架的数据！")}),_QV_="%E6%9D%AD%E5%B7%9E%E5%90%AF%E5%8D%9A%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89"});